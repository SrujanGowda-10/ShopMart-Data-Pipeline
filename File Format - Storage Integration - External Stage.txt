USE ROLE SYSADMIN;

USE DATABASE SHOPMART_DB;
USE SCHEMA PUBLIC;


CREATE OR REPLACE FILE FORMAT json_format
    TYPE = 'JSON'
;


CREATE OR REPLACE STORAGE INTEGRATION S3_SF
    TYPE = EXTERNAL_STAGE
    STORAGE_PROVIDER = 'S3'
    STORAGE_AWS_ROLE_ARN = '<iam role>'
    ENABLED = TRUE
    STORAGE_ALLOWED_LOCATIONS = ('s3://snowpark-etl-bucket')
;



CREATE OR REPLACE STAGE EXT_AWS_STAGE
    URL='s3://snowpark-etl-bucket'
    STORAGE_INTEGRATION = S3_SF
    FILE_FORMAT = (FORMAT_NAME = 'json_format')
;
